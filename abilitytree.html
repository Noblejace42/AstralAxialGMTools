<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Astral Axial Abilities</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Tech Tree Specific Styles */
    #tech-tree {
      position: relative;
      width: 100%;
      /* Height increased to accommodate 15 levels */
      height: 3500px; 
      margin-top: 20px;
    }
    .ability-card {
      background: #262626;
      border: 1px solid #444;
      border-radius: 4px;
      padding: 10px;
      position: absolute;
      box-sizing: border-box;
      width: 160px; /* Slightly narrower than before for better spacing */
    }
    .ability-card h3 {
      margin: 0 0 5px;
      font-size: 1.1em;
      color: #fff;
    }
    .ability-type {
      font-size: 0.9em;
      color: #aaa;
      margin-bottom: 5px;
    }
    .ability-description {
      font-size: 0.9em;
      color: #ccc;
    }
    /* SVG overlay for connection lines */
    #tech-tree svg {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
      overflow: visible;
    }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">System Generator</a> |
    <a href="lifepath.html">Lifepath Generator</a> |
    <a href="weapongenerator.html">Weapon Generator</a> |
    <a href="combat_tracker.html">Combat Tracker</a> |
    <a href="abilitytree.html">Abilities</a>
  </nav>

  <div class="container">
    <h1>Classless RPG Tech Tree</h1>
    <div id="tech-tree"></div>
  </div>

  <div class="art-credit">
    <a href="https://www.instagram.com/vinny.longbow?igsh=c203czNuMW92MXA3" target="_blank">
      Art Credit: Vincent Fleetwood
    </a>
  </div>

  <script>
    // All your abilities (74 total) are defined here.
    const abilities = [
      { name: "Cheap Shot", type: "encounter/combat", description: "Attack a creature, stepping up 1 die..." },
      { name: "Port in the Storm", type: "passive/buff", description: "Whenever you return to a place..." },
      { name: "Called Shot", type: "encounter/free", description: "When you succeed an attack with a near-range..." },
      { name: "Companion", type: "passive/buff", description: "Your companion is _____..." },
      { name: "Charming and Open", type: "at-will/free", description: "When you speak frankly with someone..." },
      { name: "Surging Support", type: "at-will/free", description: "You may use your surges on other players..." },
      { name: "Focused Training", type: "at-will/free", description: "When you spend a period of more than a week resting..." },
      { name: "Push beyond limit", type: "at-will/free", description: "You may step up 2 dice in your dice pool..." },
      { name: "Second Wind", type: "recovery/combat", description: "You may recuperate." },
      { name: "Gizmo Gadgeteer", type: "encounter/combat", description: "Gain 1 Strain and choose 2..." },
      { name: "Under Pressure", type: "recovery/free", description: "Once per recovery, the first time you would increase..." },
      { name: "Seeing Red", type: "passive/buff", description: "You may add your Strain die to your damage dice pool." },
      { name: "Blood for the Blood God", type: "encounter/free", description: "When you kill an opposing character..." },
      { name: "Signature Weapon", type: "passive/buff", description: "You have a weapon that is uniquely you..." },
      { name: "Troubadour", type: "passive/buff", description: "When you bolster and carouse you gain credits..." },
      { name: "Jack of all trades", type: "passive/buff", description: "Whenever you learn a new talent..." },
      { name: "Rigid Focus", type: "at-will/free", description: "When you roll a dice pool that includes a talent..." },
      { name: "Experienced Explorer", type: "passive/buff", description: "Choose up to 3 of the below terrains..." },
      { name: "Herald of Law", type: "encounter/combat", description: "When you declare that a creature is breaking the law..." },
      { name: "Windstance", type: "passive/buff", description: "When you are wearing only light armor..." },
      { name: "Unbreakable Mind", type: "passive/buff", description: "You may always add your Will die..." },
      { name: "Sheer Spite", type: "encounter/free", description: "Roll your will die and add it to the total..." },
      { name: "Bulwark", type: "encounter/combat", description: "Declare a creature standing near you..." },
      { name: "Melee Master", type: "passive/buff", description: "Whenever you use a blade or bludgeon..." },
      { name: "Dark Confidant", type: "at-will/free", description: "You may swap a die of the same size..." },
      { name: "Kingly Wit", type: "at-will/free", description: "When you dazzle, swindle, haggle with a creature..." },
      { name: "Iron-willed", type: "recovery/free", description: "When you would suffer a Strain break..." },
      { name: "Frantic Parry", type: "encounter/free", description: "When you would take damage, you may instead..." },
      { name: "Fast Learner", type: "passive/buff", description: "When you Bolster and Carouse you may forgo..." },
      { name: "Dumb Luck", type: "recovery/free", description: "Whenever you successfully resist peril..." },
      { name: "Indomitable", type: "recovery/free", description: "If you would fail an attempt to overcome..." },
      { name: "Glancing Blow", type: "encounter/free", description: "If you would take damage, you may instead..." },
      { name: "Master Quartermaster", type: "passive/buff", description: "Whenever you contest to help set up camp..." },
      { name: "Vacuum Training", type: "recovery/free", description: "If you are thrown into the vacuum of space..." },
      { name: "Flames Of My Desire", type: "passive/buff", description: "Choose one of the following desires..." },
      { name: "Rage Against the Machine", type: "encounter/free", description: "You have mastered putting yourself into a state..." },
      { name: "Tactical Reload", type: "recovery/free", description: "When you take an hour or more to examine your weapon..." },
      { name: "Juggernaut", type: "passive/buff", description: "If every worn gear slot is filled with 'heavy' gear..." },
      { name: "Gatecrasher", type: "encounter/free", description: "When you contest Might|Skill to destroy an inanimate obstacle..." },
      { name: "Strider", type: "recovery/free", description: "When you journey planetside or make camp..." },
      { name: "Black Market Connections", type: "at-will/free", description: "When you arrive at a settlement with a criminal underground..." },
      { name: "Setup Strike", type: "encounter/free", description: "When you hit an enemy with an attack, you may mark them..." },
      { name: "Sage Knight", type: "passive/buff", description: "When you spend an hour or more in quiet meditation..." },
      { name: "Blot out the Sun", type: "recovery/free", description: "When you damage using a far-range or long-range weapon..." },
      { name: "Superior Explorer", type: "at-will/free", description: "Choose up to 3 of the below terrains..." },
      { name: "Tricks of the Trade", type: "per encounter/free", description: "When you contest and roll the maximum value..." },
      { name: "The Arcane and Esoteric", type: "at-will/free", description: "When you attempt to acquire information about something puzzling..." },
      { name: "Ad Astra Per Aspera", type: "recovery/free", description: "If you would take a wound, you may instead decrease a Talent by 1." },
      { name: "The Great Escape", type: "recovery/combat", description: "During combat or a dangerous situation..." },
      { name: "Steal the Moon", type: "recovery/free", description: "Gain a Talent called 'heist planning'..." },
      { name: "Font of Knowledge", type: "at-will/free", description: "When you ask a question or seek knowledge..." },
      { name: "Fool me Once", type: "recovery/free", description: "When you fail your second contest or attack..." },
      { name: "Discombobulate", type: "encounter/free", description: "Add your Recall and Presence to your dice pool..." },
      { name: "Bullet Time", type: "recovery/free", description: "Until your next turn you cannot be the target of an attack..." },
      { name: "Hondoâ€™s Return", type: "at-will/free", description: "Whenever you return to an outpost of civilization in triumph..." },
      { name: "Punch God", type: "recovery/free", description: "If you stand defiant in the face of overwhelming odds..." },
      { name: "Shoot First", type: "recovery/free", description: "You may take the first action when you initiate combat..." },
      { name: "Ask Questions Later", type: "recovery/free", description: "If you initiate combat with a creature you were meant to interrogate..." },
      { name: "Wide Wanderer", type: "at-will/free", description: "If you journey planetside or travel through space in an unfamiliar area..." },
      { name: "Cheat Death", type: "recovery/free", description: "The next time you would die, you do not..." },
      { name: "Ace up the Sleeve", type: "passive/buff", description: "If you would roll to contest to overcome..." },
      { name: "The Ability to Speak", type: "passive/buff", description: "You can generally understand any intelligent creature..." },
      { name: "Breaker of War", type: "recovery/combat", description: "If you attempt to defuse a hostile situation..." },
      { name: "Journey Before Destination", type: "passive/buff", description: "When you journey planetside you may write a new bond..." },
      { name: "Forth Eorlingas!", type: "recovery/free", description: "If you initiate combat while outnumbered..." },
      { name: "Volta Gloria", type: "encounter/free", description: "If you have no surges and you initiate combat, gain a surge." },
      { name: "Give me Liberty!", type: "passive/buff", description: "If you die in defense of your friends or a noble cause..." },
      { name: "Resist and Bite", type: "encounter/free", description: "When you are dealt damage by a melee weapon..." },
      { name: "Heavy on the Saddle", type: "", description: "You can exceed your mass capacity by up to 50..." },
      { name: "Lucky Tool", type: "", description: "You have a special tool that carries you through your journey..." },
      { name: "NOT IMPLEMENTED FINISH", type: "", description: "" },
      { name: "Fly By Instinct", type: "", description: "You may add your Will die to your dice pool when you dogfight..." },
      { name: "Max Burn", type: "", description: "You may expend a fuel to kick your ship's engine into overdrive..." },
      { name: "Engage!", type: "", description: "You can activate an axial instantaneously, randomly giving 1d4..." }
    ];

    // We'll create 15 levels, with up to 5 nodes each.
    const maxLevel = 15;
    const nodesPerLevel = 5;

    // Assign each ability a level (1â€“15) and an ID.
    abilities.forEach((ability, i) => {
      ability.id = i + 1;
      // Compute which level: integer division by 5, plus 1
      let assignedLevel = Math.floor(i / nodesPerLevel) + 1;
      if (assignedLevel > maxLevel) assignedLevel = maxLevel;
      ability.level = assignedLevel;
    });

    // Group them by level.
    const levels = {};
    for (let lvl = 1; lvl <= maxLevel; lvl++) {
      levels[lvl] = abilities.filter(a => a.level === lvl);
    }

    // Build edges: each node from level 2..15 gets exactly 1 random prerequisite from the previous level
    const edges = [];
    for (let lvl = 2; lvl <= maxLevel; lvl++) {
      const prevLevelNodes = levels[lvl - 1];
      levels[lvl].forEach(node => {
        // Pick exactly one random predecessor from previous level
        const prereq = prevLevelNodes[Math.floor(Math.random() * prevLevelNodes.length)];
        edges.push({ from: prereq.id, to: node.id });
      });
    }

    // Render the tech tree
    function renderTechTree() {
      const container = document.getElementById("tech-tree");
      container.innerHTML = "";

      // Increase vertical gap for readability
      const verticalGap = 220;  
      // Node width slightly larger than the .ability-card width to allow spacing
      const nodeWidth = 180;    
      const containerWidth = container.clientWidth;

      // Position each node
      abilities.forEach(node => {
        const levelNodes = levels[node.level];
        const indexInLevel = levelNodes.findIndex(n => n.id === node.id);
        const count = levelNodes.length;
        const totalNodesWidth = count * nodeWidth;
        const startX = (containerWidth - totalNodesWidth) / 2;

        const nodeDiv = document.createElement("div");
        nodeDiv.className = "ability-card";
        nodeDiv.style.left = (startX + indexInLevel * nodeWidth) + "px";
        nodeDiv.style.top = ((node.level - 1) * verticalGap) + "px";
        nodeDiv.dataset.nodeId = node.id;
        nodeDiv.innerHTML = `
          <h3>${node.name}</h3>
          <p class="ability-type">${node.type}</p>
          <div class="ability-description">${node.description}</div>
        `;
        container.appendChild(nodeDiv);

        // Store positions for line drawing
        node.x = parseFloat(nodeDiv.style.left);
        node.y = parseFloat(nodeDiv.style.top);
        node.elemWidth = nodeDiv.offsetWidth;
        node.elemHeight = nodeDiv.offsetHeight;
      });

      // Create an SVG overlay to draw lines
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.style.position = "absolute";
      svg.style.top = "0";
      svg.style.left = "0";
      svg.style.width = "100%";
      svg.style.height = container.clientHeight + "px";
      svg.style.pointerEvents = "none";

      edges.forEach(edge => {
        const fromNode = abilities.find(n => n.id === edge.from);
        const toNode = abilities.find(n => n.id === edge.to);
        if (!fromNode || !toNode) return;

        // Calculate centers
        const fromX = fromNode.x + fromNode.elemWidth / 2;
        const fromY = fromNode.y + fromNode.elemHeight / 2;
        const toX = toNode.x + toNode.elemWidth / 2;
        const toY = toNode.y + toNode.elemHeight / 2;

        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", fromX);
        line.setAttribute("y1", fromY);
        line.setAttribute("x2", toX);
        line.setAttribute("y2", toY);
        line.setAttribute("stroke", "#aaa");
        line.setAttribute("stroke-width", "1.5");
        svg.appendChild(line);
      });

      container.appendChild(svg);
    }

    window.addEventListener("resize", renderTechTree);
    window.addEventListener("load", renderTechTree);
  </script>
</body>
</html>
